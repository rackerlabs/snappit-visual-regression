sudo: false
dist: trusty
language: node_js
node_js:
  - "8"
addons:
  firefox: "53.0"
  chrome: stable
install:
  - travis_retry npm install
  - mkdir -p node_modules/webdriver-manager/selenium
  - curl https://${GH_TOKEN}@api.github.com/repos/mozilla/geckodriver/releases | python -m json.tool > node_modules/webdriver-manager/selenium/gecko-response.json
  - wget -q https://{GH_TOKEN}@github.com/mozilla/geckodriver/releases/download/v0.18.0/geckodriver-v0.18.0-linux64.tar.gz -O node_modules/webdriver-manager/selenium/geckodriver-v0.18.0.tar.gz
  - yes | cp update-config.json node_modules/webdriver-manager/selenium/
  - tar -xzf node_modules/webdriver-manager/selenium/geckodriver-v0.18.0.tar.gz -C node_modules/webdriver-manager/selenium
  - mv -f node_modules/webdriver-manager/selenium/geckodriver{,-v0.18.0}
  - npm i -g greenkeeper-lockfile@1
before_script:
  - greenkeeper-lockfile-update
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - jdk_switcher use oraclejdk8
  - nohup bash -c "npm run mockserver 2>&1 &"
  - nohup bash -c "npm run webdriver 2>&1 &"
  - sleep 5
script:
  - npm test
after_script:
  - greenkeeper-lockfile-upload